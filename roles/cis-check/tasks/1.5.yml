---
- name: 1.5.1 Ensure core dumps are restricted (Scored)
  block:
    - name: 1.5.1 check security limits
      shell: 'egrep "^hard core" /etc/security/limits.conf /etc/security/limits.d/*'
      register: v151_1_output
    - name: 1.5.1 check sysctl for setuid programs for dumping core
      shell: "sysctl fs.suid_dumpable"
      register: v1515_2_output
    - name: 1.5.1 check sysctl.confs for setuid programs dumping core
      shell: 'grep -E "^fs\.suid_dumpable" /etc/sysctl.conf /etc/sysctl.d/*'
      register: v151_3_output
    - name: 1.5.1 set fact
      set_fact:
        results: "{{ results|combine({'1.5.1': v151_1_output.stdout is search('* hard core 0') and v151_2_output.stdout is search('fs.suid_dumpable = 0') and v151_3_output.stdout is search('fs.suid_dumpable = 0')}) }}"
- name: 1.5.2 Ensure XD/NX support is enabled (Not Scored)
  block:
    - name: 1.5.2 check No Execution option
      shell: "dmesg | grep NX"
      register: v152_output
    - name: 1.5.2 set fact
      set_fact:
        results: "{{ results|combine({'1.5.2': 'NX (Execute Disable) protection: active' in v152_output.stdout }) }}"
- name: 1.5.3 Ensure address space layout randomization (ASLR) is enabled (Scored)
  block:
    - name: 1.5.3 check sysctl for address randomization
      shell: "sysctl kernel.randomize_va_space"
      register: v153_1_output
    - name: 1.5.3 check sysctl conf
      shell: 'grep -E "^kernel\.randomize_va_space" /etc/sysctl.conf /etc/sysctl.d/*'
      register: v153_2_output
    - name: 1.5.3 set fact
      set_fact:
        results: "{{ results|combine({'1.5.3': 'kernel.randomize_va_space = 2' in v153_2_output and 'kernel.randomize_va_space = 2' in v153_1_output.stdout}) }}"
- name: 1.5.4 Ensure prelink is disabled (Scored)
  block:
    - name: 1.5.4 check prelink application
      shell: "rpm -q prelink"
      register: v154_output
    - name: 1.5.4 set fact
      set_fact:
        results: "{{ results|combine({'1.5.4': 'package prelink is not installed' in v154_output.stdout })}}"





